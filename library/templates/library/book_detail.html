{% extends "library/base_layout.html" %}

{% block content %}

    <div class="card">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Book Details</h2>
            <span style="padding: 6px 12px; border-radius: 12px; font-weight: 600;
                {% if book.status == 'Available' %}background-color: #dcfce7; color: #166534;
                {% elif book.status == 'Checked Out' %}background-color: #fee2e2; color: #991b1b;
                {% else %}background-color: #f1f5f9; color: #475569;{% endif %}">
                {{ book.status }}
            </span>
        </div>
        
        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="title">Book Title:</label>
                <input type="text" id="title" name="title" value="{{ book.title }}" required>
            </div>

            <div class="form-group">
                <label for="author_name">Author Name:</label>
                <input type="text" id="author_name" name="author_name" value="{{ book.author.authorname }}" list="authors_list" required>
                <datalist id="authors_list">
                    {% for author in authors %}
                        <option value="{{ author.authorname }}">
                    {% endfor %}
                </datalist>
            </div>

            <div class="form-group">
                <label for="isbn">ISBN:</label>
                <input type="text" id="isbn" name="isbn" value="{{ book.isbn }}" required maxlength="13">
            </div>

            <div class="form-group">
                <label for="genre">Genre:</label>
                <input type="text" id="genre" name="genre" value="{{ book.genre }}">
            </div>
            
            <div class="form-group">
                <label for="status">Status:</label>
                <select id="status" name="status" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px;">
                    <option value="Available" {% if book.status == 'Available' %}selected{% endif %}>Available</option>
                    <option value="Checked Out" {% if book.status == 'Checked Out' %}selected{% endif %}>Checked Out</option>
                    <option value="Lost" {% if book.status == 'Lost' %}selected{% endif %}>Lost</option>
                    <option value="Maintenance" {% if book.status == 'Maintenance' %}selected{% endif %}>Maintenance</option>
                </select>
            </div>

            <button type="submit" class="submit-btn">Update Book</button>
        </form>
    </div>

    <!-- Loan History -->
    <div class="card">
        <div class="card-header">
            <h3>ðŸ“œ Loan History</h3>
        </div>
        {% if loan_history %}
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8fafc; text-align: left;">
                        <th style="padding: 10px; border-bottom: 2px solid #e2e8f0;">Member</th>
                        <th style="padding: 10px; border-bottom: 2px solid #e2e8f0;">Checked Out</th>
                        <th style="padding: 10px; border-bottom: 2px solid #e2e8f0;">Returned</th>
                    </tr>
                </thead>
                <tbody>
                    {% for loan in loan_history %}
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <a href="{% url 'member_detail' loan.member.memberid %}" style="color: #3b82f6; text-decoration: none;">
                                {{ loan.member.firstname }} {{ loan.member.lastname }}
                            </a>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">{{ loan.checkoutdate }}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">{{ loan.returndate|default:"Not Returned" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="color: #64748b;">No loan history found for this book.</p>
        {% endif %}
    </div>

{% endblock %}